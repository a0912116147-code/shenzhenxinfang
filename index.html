<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ·±åœ³æ¥¼ç›˜</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2D3142">

    <!-- PDFå¯¼å‡ºåº“ - html2canvas + jsPDF æ–¹æ¡ˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* === åŸºç¡€æ ·å¼ === */
        :root {
            --primary-color: #2D3142;
            --sidebar-bg: #2D3142;
            --main-bg: #F5F7FA;
            --card-bg: #fff;
            --border-color: #e0e0e0;
            --text-dark: #2D3142;
            --text-light: #6c757d;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --card-shadow-hover: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: "Microsoft YaHei", -apple-system, sans-serif;
            height: 100vh;
            display: flex;
            overflow: hidden;
            color: #333;
            background: #F5F7FA;
        }

        /* === æ°´å°æ ·å¼ä¿®æ­£ç‰ˆ (æ”¯æŒæ¢è¡Œ) === */
        .watermark-container {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 9999;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: center;
            overflow: hidden;
            opacity: 0.1;
            /* é€æ˜åº¦ */
        }

        .watermark-text {
            transform: rotate(-25deg);
            font-size: 15px;
            color: #000;
            font-weight: 800;
            margin: 60px 40px;
            width: 320px;
            /* å®½åº¦ç»™å¤Ÿï¼Œé˜²æ­¢æˆªæ–­ */
            text-align: center;
            line-height: 1.5;
            white-space: pre-wrap;
            /* å…³é”®ï¼šå…è®¸\næ¢è¡Œ */
        }

        /* ä¾§è¾¹æ  & æœç´¢ */
        .sidebar {
            width: 320px;
            background: #2D3142;
            border-right: none;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            height: 100%;
            user-select: none;
        }

        .sidebar-header {
            padding: 25px 20px;
            background: #2D3142;
            color: #fff;
            display: flex;
            flex-direction: column;
            gap: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 20px;
            font-weight: bold;
            color: #fff;
        }

        /* æµè§ˆç»Ÿè®¡æŒ‰é’® */
        .stats-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .stats-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .stats-btn:active {
            transform: scale(0.95);
        }


        /* æœç´¢æ¡†æ ·å¼ */
        .search-box {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .search-box:focus {
            background: #fff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .nav-tree {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 50px;
        }

        /* å¯¼èˆªèŠ‚ç‚¹ */
        .nav-group {
            display: none;
        }

        .nav-group.show {
            display: block;
        }

        .has-arrow::after {
            content: 'â–¸';
            float: right;
            color: #999;
            transform: rotate(0);
            transition: transform 0.2s;
        }

        .has-arrow.open::after {
            transform: rotate(90deg);
        }

        .level-1 {
            padding: 16px 20px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            background: transparent;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.2s;
            position: relative;
        }

        .level-1:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }

        .level-1:active {
            background: rgba(255, 255, 255, 0.08);
        }

        .level-2 {
            padding: 12px 20px 12px 30px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            background: rgba(0, 0, 0, 0.1);
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.2s;
        }

        .level-2:hover {
            background: rgba(255, 255, 255, 0.08);
            color: #fff;
        }

        .level-2:active {
            background: rgba(255, 255, 255, 0.1);
        }

        .level-2.active {
            background: rgba(102, 126, 234, 0.25);
            color: #fff;
            font-weight: 600;
            border-left-color: #667eea;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            overflow-y: auto;
            position: relative;
            scroll-behavior: smooth;
            background: #f5f7fa;
        }

        .content-wrapper {
            max-width: 960px;
            margin: 0 auto;
            padding: 30px;
        }

        /* å†…å®¹æ ·å¼ */
        .content-body {
            background: #fff;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--card-shadow);
        }

        .content-body p {
            line-height: 1.7;
            margin-bottom: 12px;
            text-align: justify;
            color: #333;
            font-size: 15px;
        }

        .content-body h2 {
            color: var(--primary-dark);
            border-left: 4px solid var(--primary-color);
            padding-left: 12px;
            margin: 24px 0 16px;
            font-size: 20px;
            font-weight: 700;
        }

        .content-body h3 {
            color: var(--primary-color);
            margin: 20px 0 12px;
            font-size: 17px;
            font-weight: 600;
        }

        /* é¢åŒ…å±‘å¯¼èˆª */
        .breadcrumb {
            font-size: 13px;
            color: #999;
            margin-bottom: 16px;
            padding: 8px 12px;
            background: #f8f9fa;
            border-radius: 8px;
            display: inline-block;
        }

        /* é¡µé¢æ ‡é¢˜ */
        .page-header {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-dark);
            margin: 0 0 20px;
        }

        /* ä»·æ ¼åœ°å›¾å®¹å™¨ */
        .price-map-container {
            background: #fff;
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--card-shadow);
            overflow-x: auto;
        }

        .price-map-container section {
            margin-bottom: 30px;
        }

        .price-map-container section:last-child {
            margin-bottom: 0;
        }

        .price-map-container h2 {
            color: var(--primary-dark);
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 16px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }

        .price-map-container h3 {
            color: var(--primary-color);
            font-size: 17px;
            font-weight: 600;
            margin: 20px 0 12px;
        }

        .price-map-container table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 14px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .price-map-container table th,
        .price-map-container table td {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
        }

        .price-map-container table th {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            font-weight: 600;
        }

        .price-map-container table td {
            background: white;
            color: #333;
        }

        .price-map-container tr:nth-child(even) td {
            background: #f8f9fa;
        }

        .price-map-container tr:hover td {
            background: #e8f4fc;
        }

        .price-map-container p {
            font-size: 15px;
            line-height: 1.7;
            margin-bottom: 12px;
            color: #333;
        }

        .price-map-container .warning,
        .price-map-container .highlight {
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
        }

        .content-body ul {
            padding-left: 20px;
            margin: 10px 0;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 16px 0;
            font-size: 14px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* è¡¨æ ¼å®¹å™¨ - ç”¨äºç§»åŠ¨ç«¯æ¨ªå‘æ»šåŠ¨ */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 16px -16px;
            padding: 0 16px;
            position: relative;
        }

        .table-container table {
            margin: 0;
            min-width: 100%;
        }

        /* è¡¨æ ¼æ»šåŠ¨æç¤º */
        .table-container::after {
            content: 'ğŸ‘‰ å·¦å³æ»‘åŠ¨æŸ¥çœ‹';
            position: absolute;
            right: 10px;
            top: 10px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }

        @media (max-width: 768px) {
            .table-container::after {
                opacity: 1;
            }
        }

        th,
        td {
            border: none;
            padding: 12px 15px;
            text-align: left;
        }

        th {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            font-weight: 600;
            width: 25%;
            color: #495057;
        }

        tr:nth-child(even) {
            background-color: #fafbfc;
        }

        tr:hover {
            background-color: #f0f4f8;
        }

        td:first-child {
            border-left: 3px solid var(--primary-color);
        }

        /* === å½©è‰²æ¸å˜å¡ç‰‡ç½‘æ ¼æ ·å¼ === */
        .project-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .project-card {
            background: #fff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .project-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease;
        }

        .project-card:nth-child(4n+1)::before {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .project-card:nth-child(4n+2)::before {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .project-card:nth-child(4n+3)::before {
            background: linear-gradient(135deg, #fad0c4 0%, #ffd1ff 100%);
        }

        .project-card:nth-child(4n+4)::before {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .project-card:hover::before {
            transform: scaleX(1);
        }

        .project-card-title {
            font-size: 18px;
            font-weight: 700;
            color: #2D3142;
            margin-bottom: 12px;
        }

        .project-card-location {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 15px;
            display: inline-block;
            padding: 4px 12px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .project-card-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }

        .project-card-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 12px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .project-card-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }

        .project-card-btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .project-card-btn-secondary {
            background: #f8f9fa;
            color: #495057;
        }

        .project-card-btn-secondary:hover {
            background: #e9ecef;
        }

        .highlight {
            background: linear-gradient(135deg, #e8f4fc, #d6eaf8);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px rgba(46, 134, 193, 0.15);
        }

        .price-comparison,
        .special-offer {
            background: linear-gradient(135deg, #e8f6f3, #d5f4e6);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid var(--success-color);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.15);
        }

        .disadvantages {
            background: linear-gradient(135deg, #fdedec, #fadbd8);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid var(--danger-color);
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.15);
        }

        .summary {
            background: linear-gradient(135deg, #fef9e7, #fcf3cf);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            border-left: 4px solid var(--accent-color);
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.15);
        }

        .placeholder {
            padding: 50px;
            text-align: center;
            color: #999;
            border: 2px dashed #e0e0e0;
            border-radius: 16px;
            background: linear-gradient(135deg, #fafafa, #f5f5f5);
        }

        /* æœç´¢ç»“æœæ ·å¼ */
        .search-result-item {
            padding: 14px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.2s;
            background: #fff;
        }

        .search-result-item:active {
            background: #f5f7fa;
            transform: scale(0.99);
        }

        .search-path {
            font-size: 11px;
            color: #999;
            margin-bottom: 4px;
        }

        .search-name {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 14px;
        }

        .search-match {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* === æ‚¬æµ®çƒ & è´­ç‰©è½¦åŠŸèƒ½ === */
        .floating-ball {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: #000;
            border-radius: 50%;
            box-shadow: 0 4px 16px rgba(46, 134, 193, 0.4);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .floating-ball:active {
            transform: scale(0.92);
        }

        .ball-count {
            font-size: 17px;
            font-weight: 700;
        }

        .ball-label {
            font-size: 9px;
            opacity: 0.95;
        }

        /* è´­ç‰©è½¦å¼¹çª— */
        .cart-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .cart-modal.active {
            display: flex;
        }

        /* ç»Ÿè®¡å¼¹çª— */
        .stats-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        .stats-modal.active {
            display: flex;
        }

        .cart-content {
            background: #fff;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .cart-header {
            padding: 24px;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h3 {
            margin: 0;
            font-size: 18px;
        }

        .cart-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .cart-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
            transition: background 0.2s;
        }

        .cart-item:active {
            background: #f8f9fa;
        }

        .cart-footer {
            padding: 20px;
            border-top: 1px solid #f0f0f0;
            text-align: center;
            background: #fafbfc;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: #000;
            border: none;
            padding: 14px 32px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(46, 134, 193, 0.3);
            transition: all 0.3s;
        }

        .btn-primary:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(46, 134, 193, 0.4);
        }

        .add-to-cart-btn {
            display: inline-block;
            background: linear-gradient(135deg, var(--success-color), #229954);
            color: #000;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
            cursor: pointer;
            vertical-align: middle;
            box-shadow: 0 2px 6px rgba(39, 174, 96, 0.3);
            transition: all 0.2s;
        }

        .add-to-cart-btn:active {
            transform: scale(0.95);
        }

        .add-to-cart-btn.added {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            cursor: default;
            box-shadow: none;
        }

        /* ç»Ÿè®¡å†…å®¹æ ·å¼ */
        .stats-content {
            background: #fff;
            width: 90%;
            max-width: 500px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .stats-header {
            padding: 20px 24px;
            background: linear-gradient(135deg, var(--accent-color), #e67e22);
            color: #fff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stats-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: bold;
        }

        .stats-close {
            cursor: pointer;
            font-size: 24px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .stats-close:hover {
            opacity: 1;
        }

        .stats-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .stats-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }

        .stats-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .stats-item-name {
            font-weight: 600;
            color: #333;
        }

        .stats-item-count {
            background: linear-gradient(135deg, var(--accent-color), #e67e22);
            color: #fff;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .stats-empty {
            text-align: center;
            color: #999;
            padding: 40px 20px;
        }

        .stats-footer {
            padding: 16px;
            background: #fafbfc;
            border-top: 1px solid #f0f0f0;
            text-align: center;
        }

        .stats-clear-btn {
            background: none;
            border: 1px solid #e74c3c;
            color: #e74c3c;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }

        .stats-clear-btn:hover {
            background: #e74c3c;
            color: #fff;
        }

        /* æ‰‹æœºé€‚é… */
        .menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 200;
            background: #fff;
            padding: 10px 14px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-color);
            transition: all 0.3s;
        }

        .menu-toggle:active {
            transform: scale(0.95);
            background: var(--primary-color);
            color: #fff;
        }

        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 90;
            backdrop-filter: blur(2px);
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 85%;
                transform: translateX(-100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                z-index: 100;
                box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-header {
                padding: 24px 15px;
            }

            .sidebar-header h2 {
                font-size: 18px;
            }

            .menu-toggle {
                display: block;
            }

            .overlay.active {
                display: block;
            }

            .content-wrapper {
                padding: 65px 10px 80px;
            }

            .content-body {
                padding: 16px;
                border-radius: 12px;
            }

            /* é¢åŒ…å±‘å¯¼èˆªç§»åŠ¨ç«¯ä¼˜åŒ– */
            .breadcrumb {
                font-size: 11px;
                padding: 6px 10px;
                margin-bottom: 12px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 100%;
            }

            /* é¡µé¢æ ‡é¢˜ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .page-header {
                font-size: 18px;
                margin: 0 0 12px;
                line-height: 1.3;
            }

            .content-body p {
                font-size: 14px;
                line-height: 1.65;
                margin-bottom: 10px;
            }

            .content-body h2 {
                font-size: 15px;
                margin: 14px 0 8px;
                padding-left: 8px;
            }

            .content-body h3 {
                font-size: 14px;
                margin: 10px 0 6px;
            }

            /* è¡¨æ ¼ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .table-container {
                margin: 12px -16px;
                padding: 0 12px;
            }

            table {
                font-size: 12px;
                margin: 0;
            }

            th, td {
                padding: 10px 8px !important;
                font-size: 12px;
                white-space: nowrap;
            }

            /* æ»šåŠ¨ï¿½ï¿½ï¿½ç¤º */
            .table-container::after {
                content: '';
                position: absolute;
                right: 0;
                top: 0;
                bottom: 0;
                width: 20px;
                background: linear-gradient(90deg, transparent, rgba(0,0,0,0.05));
                pointer-events: none;
            }

            /* é«˜äº®å—ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .highlight,
            .price-comparison,
            .special-offer,
            .disadvantages,
            .summary {
                padding: 14px;
                margin: 14px 0;
                border-radius: 10px;
            }

            /* åˆ—è¡¨ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .content-body ul {
                padding-left: 18px;
                margin: 8px 0;
            }

            .content-body li {
                margin-bottom: 6px;
                font-size: 14px;
            }

            /* æŒ‰é’®ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .add-to-cart-btn {
                padding: 6px 12px;
                font-size: 11px;
                margin-left: auto;
                flex-shrink: 0;
            }

            /* é¡µé¢æ ‡é¢˜å®¹å™¨ä¼˜åŒ– */
            .content-wrapper > div:first-child > div[style*="display:flex"] {
                flex-wrap: wrap;
                gap: 10px;
                align-items: flex-start;
            }

            /* æ‚¬æµ®çƒç§»åŠ¨ç«¯ä½ç½®è°ƒæ•´ */
            .floating-ball {
                bottom: 20px;
                right: 16px;
                width: 50px;
                height: 50px;
            }

            .ball-count {
                font-size: 15px;
            }

            .ball-label {
                font-size: 8px;
            }

            /* è´­ç‰©è½¦å¼¹çª—ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .cart-content {
                width: 93%;
                max-height: 75vh;
            }

            .cart-header {
                padding: 20px;
            }

            .cart-header h3 {
                font-size: 16px;
            }

            .cart-body {
                padding: 16px;
            }

            .cart-item {
                padding: 10px 0;
                font-size: 13px;
            }

            .cart-footer {
                padding: 16px;
            }

            .btn-primary {
                padding: 12px 24px;
                font-size: 14px;
            }

            /* æ°´å°ä¼˜åŒ– */
            .watermark-text {
                font-size: 12px;
                margin: 100px 40px;
                width: 260px;
            }

            /* ä»·æ ¼åœ°å›¾ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .price-map-container {
                padding: 16px;
                border-radius: 12px;
            }

            .price-map-container h2 {
                font-size: 16px;
                margin-bottom: 12px;
            }

            .price-map-container h3 {
                font-size: 14px;
                margin: 14px 0 8px;
            }

            .price-map-container p {
                font-size: 13px;
                line-height: 1.6;
            }

            .price-map-container table {
                font-size: 11px;
                margin: 12px 0;
            }

            .price-map-container table th,
            .price-map-container table td {
                padding: 8px 6px;
                font-size: 11px;
            }

            .price-map-container .warning,
            .price-map-container .highlight {
                padding: 12px;
                margin: 12px 0;
                font-size: 13px;
            }
        }

        /* === ä¸‹è½½é€‰é¡¹å¼¹çª—æ ·å¼ === */
        .download-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .download-modal-content {
            background: white;
            border-radius: 20px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .download-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
        }

        .download-modal-header h3 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        .download-options {
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .download-option-btn {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .download-option-btn:hover {
            background: #e3f2fd;
            border-color: var(--primary-color);
        }

        .download-option-btn:active {
            transform: scale(0.98);
        }

        .download-icon {
            font-size: 32px;
            margin-right: 15px;
        }

        .download-option-text strong {
            display: block;
            font-size: 15px;
            color: #333;
            margin-bottom: 4px;
        }

        .download-option-text small {
            display: block;
            font-size: 12px;
            color: #666;
        }

        .download-tip {
            padding: 15px 20px;
            background: #fff3cd;
            border-top: 1px solid #f0f0f0;
            font-size: 13px;
            color: #856404;
            border-radius: 0 0 20px 20px;
        }

        /* === iOSæµè§ˆå™¨å¼•å¯¼æ ·å¼ === */
        .ios-guide {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10001;
            padding: 20px;
        }

        .ios-guide-content {
            color: white;
            text-align: center;
            padding-top: 60px;
        }

        .ios-guide-arrow {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(20px); }
        }

        .ios-guide-content p {
            font-size: 18px;
            margin: 15px 0;
            line-height: 1.6;
        }

        .ios-guide-content strong {
            color: #ffd700;
            font-size: 20px;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .download-modal-content {
                max-width: 90%;
            }
            .download-option-btn {
                padding: 12px;
            }
        }
    </style>
</head>

<body>
    <div class="watermark-container" id="watermark"></div>

    <div class="floating-ball" onclick="openCart()">
        <span class="ball-count" id="cartCount">0</span>
        <span class="ball-label">ç”ŸæˆæŠ¥å‘Š</span>
    </div>

    <div class="cart-modal" id="cartModal">
        <div class="cart-content">

            <div class="cart-header">
                <h3>ğŸ“¦ ä¸“å±ç½®ä¸šæŠ¥å‘Šæ¸…å•</h3>
                <span style="cursor:pointer; font-size:20px;" onclick="closeCart()">Ã—</span>
            </div>

            <div class="cart-body" id="cartList">
                <p style="text-align:center; color:#999;">
                    è¿˜æ²¡æœ‰æ·»åŠ æ¥¼ç›˜ã€‚<br>è¯·åœ¨æ¥¼ç›˜è¯¦æƒ…é¡µç‚¹å‡»"+ åŠ å…¥æŠ¥å‘Š"
                </p>
            </div>

            <div class="cart-footer">
                <button class="btn-primary" onclick="showDownloadOptions()">â¬‡ï¸ å¯¼å‡ºä¸“å±æŠ¥å‘Š</button>
            </div>

            <!-- ä¸‹è½½é€‰é¡¹å¼¹çª— -->
            <div class="download-modal" id="downloadModal" style="display:none;">
                <div class="download-modal-content">
                    <div class="download-modal-header">
                        <h3>ğŸ“„ é€‰æ‹©å¯¼å‡ºæ ¼å¼</h3>
                        <span onclick="closeDownloadModal()" style="cursor:pointer;font-size:24px;">&times;</span>
                    </div>
                    <div class="download-options">
                        <button class="download-option-btn" onclick="generateShareLink()">
                            <span class="download-icon">ğŸ”—</span>
                            <div class="download-option-text">
                                <strong>ç”Ÿæˆåˆ†äº«é“¾æ¥ (æ¨è)</strong>
                                <small>å®¢æˆ·åªçœ‹åˆ°é€‰ä¸­çš„é¡¹ç›®ï¼Œä¸“ä¸šä¸”å®‰å…¨</small>
                            </div>
                        </button>
                        <button class="download-option-btn" onclick="showClientNameInput()">
                            <span class="download-icon">ğŸ“‹</span>
                            <div class="download-option-text">
                                <strong>PDFæ–‡ä»¶ï¼ˆæ‚å¿—çº§æ’ç‰ˆï¼‰</strong>
                                <small>ä¸“ä¸šæŠ¥å‘Šï¼Œå«å°é¢ã€ç›®å½•ã€åç‰‡</small>
                            </div>
                        </button>
                    </div>
                    <div class="download-tip">
                        ğŸ’¡ æç¤ºï¼šåˆ†äº«é“¾æ¥æœ€æ–¹ä¾¿ï¼Œå®¢æˆ·ç‚¹å¼€ç›´æ¥çœ‹åˆ°ä½ æ¨èçš„é¡¹ç›®
                    </div>
                </div>
            </div>

            <!-- iOSæµè§ˆå™¨å¼•å¯¼é®ç½© -->
            <div class="ios-guide" id="iosGuide" style="display:none;">
                <div class="ios-guide-content">
                    <div class="ios-guide-arrow">â†—</div>
                    <p>ç‚¹å‡»å³ä¸Šè§’ <strong>"..."</strong></p>
                    <p>é€‰æ‹© <strong>"åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"</strong></p>
                    <p style="font-size:14px;color:#999;margin-top:15px;">è¿™æ ·å¯ä»¥é€‰æ‹©Safariæˆ–å…¶ä»–æµè§ˆå™¨</p>
                </div>
            </div>

        </div>
    </div>

    <!-- æµè§ˆç»Ÿè®¡å¼¹çª— -->
    <div class="stats-modal" id="statsModal">
        <div class="stats-content">
            <div class="stats-header">
                <h3>ğŸ“Š æµè§ˆç»Ÿè®¡</h3>
                <span class="stats-close" onclick="closeStats()">Ã—</span>
            </div>

            <div class="stats-body" id="statsList">
                <!-- ç»Ÿè®¡åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <div class="stats-footer">
                <button class="stats-clear-btn" onclick="clearStats()">ğŸ—‘ï¸ æ¸…ç©ºç»Ÿè®¡</button>
            </div>
        </div>
    </div>

    <div class="menu-toggle" onclick="toggleMobileMenu()">â˜° ç›®å½•</div>
    <div class="overlay" onclick="toggleMobileMenu()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 id="appTitle">æ·±åœ³æ¥¼ç›˜</h2>
            <input type="text" id="searchInput" class="search-box" placeholder="ğŸ” æœæ¥¼ç›˜ / åŒºåŸŸ / 300ä¸‡..."
                oninput="handleSearch(this.value)">
            <button class="stats-btn" onclick="showStats()">
                <span>ğŸ“Š</span>
                <span>æµè§ˆç»Ÿè®¡</span>
            </button>
        </div>
        <div class="nav-tree" id="navTree"></div>
    </aside>

    <main class="main-content">
        <div class="content-wrapper" id="contentArea">
            <div style="text-align:center; margin-top:100px; color:#999;">è¯·é€‰æ‹©å·¦ä¾§æ¥¼ç›˜æŸ¥çœ‹è¯¦æƒ…<br><br>æ•°æ®åŠ è½½è‡ª data.js</div>
        </div>
    </main>

    <script src="js/data_core.js"></script>
    <script src="js/data_baoshan.js"></script>
    <script src="js/data_shajing.js"></script>
    <script src="js/data_futian.js"></script>
    <script src="js/data_longhua.js"></script>
    <script src="js/data_guangming.js"></script>
    <script>
        // --- æ°´å°ç”Ÿæˆï¼ˆå·²æ›´æ–°æ–‡å­—ï¼‰ ---
        function initWatermark() {
            const container = document.getElementById('watermark');
            // ä½¿ç”¨ \n æ¢è¡Œï¼Œæ ·å¼ä¸­ white-space: pre-wrap ä¿è¯æ¢è¡Œç”Ÿæ•ˆ
            const text = "è´å£³æé‡‘æ¾17277898972\né¢„çº¦çœ‹æˆ¿é¢†ä¸“å±æŠ˜æ‰£ï¼ˆæ€»ä»·çš„ä¸€ä¸ªç‚¹èµ·ï¼‰";

            // ç”Ÿæˆæ°´å°ï¼Œæ•°é‡å‡å°‘é¿å…è¿‡äºå¯†é›†
            for (let i = 0; i < 6; i++) {
                const div = document.createElement('div');
                div.className = 'watermark-text';
                div.innerText = text;
                container.appendChild(div);
            }
        }
        initWatermark();

        // --- æµè§ˆç»Ÿè®¡åŠŸèƒ½ï¼ˆä¼˜åŒ–ç‰ˆï¼‰ ---
        /**
         * æµè§ˆç»Ÿè®¡è§„åˆ™ï¼š
         * 1. æ¯æ¬¡è¿›å…¥æ¥¼ç›˜è¯¦æƒ…é¡µè®¡æ•°+1
         * 2. åŒä¸€ä¼šè¯å†…é‡å¤è¿›å…¥åŒä¸€æ¥¼ç›˜ä¸é‡å¤è®¡æ•°ï¼ˆä½¿ç”¨sessionStorageï¼‰
         * 3. åˆ·æ–°é¡µé¢åé‡æ–°è®¡æ•°
         * 4. ä»·æ ¼åœ°å›¾ä¸è®¡å…¥ç»Ÿè®¡
         */
        function recordView(region, sub, proj) {
            const key = `${region}|${sub}|${proj}`;

            // æ£€æŸ¥æœ¬æ¬¡ä¼šè¯æ˜¯å¦å·²ç»æµè§ˆè¿‡
            const sessionKey = 'viewed_' + key;
            if (sessionStorage.getItem(sessionKey)) {
                return; // æœ¬æ¬¡ä¼šè¯å·²æµè§ˆè¿‡ï¼Œä¸é‡å¤è®¡æ•°
            }

            const stats = JSON.parse(localStorage.getItem('viewStats') || '{}');

            if (!stats[key]) {
                stats[key] = {
                    region: region,
                    sub: sub,
                    proj: proj,
                    count: 0,
                    lastView: new Date().toISOString()
                };
            }

            stats[key].count++;
            stats[key].lastView = new Date().toISOString();

            localStorage.setItem('viewStats', JSON.stringify(stats));
            sessionStorage.setItem(sessionKey, 'true'); // æ ‡è®°æœ¬æ¬¡ä¼šè¯å·²æµè§ˆ
        }

        // æ˜¾ç¤ºç»Ÿè®¡å¼¹çª—
        function showStats() {
            const modal = document.getElementById('statsModal');
            const list = document.getElementById('statsList');

            modal.classList.add('active');

            const stats = JSON.parse(localStorage.getItem('viewStats') || '{}');
            const entries = Object.entries(stats);

            if (entries.length === 0) {
                list.innerHTML = `
                    <div class="stats-empty">
                        <p>æš‚æ— æµè§ˆè®°å½•</p>
                        <p style="font-size:12px; margin-top:10px;">æŸ¥çœ‹æ¥¼ç›˜è¯¦æƒ…åä¼šè‡ªåŠ¨ç»Ÿè®¡</p>
                    </div>
                `;
                return;
            }

            // æŒ‰æµè§ˆæ¬¡æ•°æ’åº
            const sorted = entries.sort((a, b) => b[1].count - a[1].count);

            list.innerHTML = sorted.map(([key, data]) => `
                <div class="stats-item">
                    <div>
                        <div class="stats-item-name">${data.proj}</div>
                        <div style="font-size:11px; color:#666; margin-top:4px;">
                            ${data.region} - ${data.sub}
                        </div>
                    </div>
                    <div class="stats-item-count">${data.count}æ¬¡</div>
                </div>
            `).join('');
        }

        // å…³é—­ç»Ÿè®¡å¼¹çª—
        function closeStats() {
            document.getElementById('statsModal').classList.remove('active');
        }

        // æ¸…ç©ºç»Ÿè®¡
        function clearStats() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æµè§ˆç»Ÿè®¡å—ï¼Ÿ')) {
                localStorage.removeItem('viewStats');
                showStats(); // åˆ·æ–°æ˜¾ç¤º
            }
        }

        // --- æ•°æ®åˆå¹¶é€»è¾‘ ---
        if (typeof db_baoshan !== 'undefined') Object.assign(db, db_baoshan);
        if (typeof db_shajing !== 'undefined') Object.assign(db, db_shajing);
        if (typeof db_futian !== 'undefined') Object.assign(db, db_futian);
        if (typeof db_longhua !== 'undefined') Object.assign(db, db_longhua);
        if (typeof db_guangming !== 'undefined') Object.assign(db, db_guangming);

        // --- å›¾ç‰‡åŠ è½½å¤±è´¥å¤„ç† ---
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸ºæ‰€æœ‰å›¾ç‰‡æ·»åŠ é”™è¯¯å¤„ç†
            document.addEventListener('error', function(e) {
                if (e.target.tagName === 'IMG') {
                    e.target.style.display = 'none';
                    const placeholder = document.createElement('div');
                    placeholder.style.cssText = 'padding:20px;background:#f5f5f5;border:1px dashed #ccc;text-align:center;color:#999;font-size:12px;border-radius:4px;';
                    placeholder.textContent = 'å›¾ç‰‡åŠ è½½å¤±è´¥';
                    e.target.parentNode.insertBefore(placeholder, e.target);
                }
            }, true);
        });

        // --- è´­ç‰©è½¦/æŠ¥å‘Šç³»ç»Ÿï¼ˆå¸¦æŒä¹…åŒ–ï¼‰ ---
        let reportCart = new Set(); // å­˜å‚¨æ ¼å¼: "Region|Sub|Project"
        let isShareMode = false; // åˆ†äº«æ¨¡å¼æ ‡è®°
        const MAX_SHARE_PROJECTS = 10; // åˆ†äº«é“¾æ¥æœ€å¤šæ”¯æŒ10ä¸ªæ¥¼ç›˜

        // ç”Ÿæˆå®‰å…¨çš„æŒ‰é’®IDï¼ˆP0-3ä¿®å¤ï¼šé¿å…ç‰¹æ®Šå­—ç¬¦é—®é¢˜ï¼‰
        function generateBtnId(region, sub, proj) {
            const key = `${region}|${sub}|${proj}`;
            // ä½¿ç”¨ç®€å•çš„hashç®—æ³•ç”Ÿæˆå®‰å…¨ID
            let hash = 0;
            for (let i = 0; i < key.length; i++) {
                const char = key.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return 'cart-btn-' + Math.abs(hash);
        }

        // ä»localStorageåŠ è½½è´­ç‰©è½¦æ•°æ®
        function loadCartFromStorage() {
            // åˆ†äº«æ¨¡å¼ä¸‹ä¸åŠ è½½æœ¬åœ°æ•°æ®
            if (isShareMode) return;

            try {
                const saved = localStorage.getItem('reportCart');
                if (saved) {
                    const arr = JSON.parse(saved);
                    reportCart = new Set(arr);
                    updateCartCount();
                }
            } catch (e) {
                console.error('åŠ è½½è´­ç‰©è½¦å¤±è´¥:', e);
            }
        }

        // ä¿å­˜è´­ç‰©è½¦åˆ°localStorage
        function saveCartToStorage() {
            // åˆ†äº«æ¨¡å¼ä¸‹ä¸ä¿å­˜åˆ°localStorageï¼ˆP0-2ä¿®å¤ï¼‰
            if (isShareMode) return;

            try {
                const arr = Array.from(reportCart);
                localStorage.setItem('reportCart', JSON.stringify(arr));
            } catch (e) {
                console.error('ä¿å­˜è´­ç‰©è½¦å¤±è´¥:', e);
            }
        }

        function updateCartCount() {
            document.getElementById('cartCount').innerText = reportCart.size;
        }

        function addToCart(region, sub, proj) {
            const key = `${region}|${sub}|${proj}`;
            const btnId = generateBtnId(region, sub, proj);

            // é˜²é‡å¤æ·»åŠ 
            if (reportCart.has(key)) {
                showToast('è¯¥æ¥¼ç›˜å·²åœ¨æŠ¥å‘Šä¸­');
                return;
            }

            reportCart.add(key);
            updateCartCount();
            saveCartToStorage(); // æŒä¹…åŒ–

            // æ›´æ–°æŒ‰é’®çŠ¶æ€ï¼ˆä½¿ç”¨å®‰å…¨IDï¼‰
            const btn = document.getElementById(btnId);
            if (btn) {
                btn.innerText = 'å·²åŠ å…¥';
                btn.classList.add('added');
                // é˜²æ­¢å¿«é€Ÿè¿ç»­ç‚¹å‡»
                btn.style.pointerEvents = 'none';
                setTimeout(() => {
                    btn.style.pointerEvents = 'auto';
                }, 500);
            }

            showToast('âœ… å·²åŠ å…¥æŠ¥å‘Š');
        }

        function removeFromCart(key) {
            reportCart.delete(key);
            updateCartCount();
            saveCartToStorage(); // æŒä¹…åŒ–
            openCart(); // åˆ·æ–°åˆ—è¡¨
        }

        function openCart() {
            const modal = document.getElementById('cartModal');
            const list = document.getElementById('cartList');
            modal.classList.add('active');
            list.innerHTML = '';

            if (reportCart.size === 0) {
                list.innerHTML = `<p style="text-align:center; color:#999; margin-top:20px;">
    è¿˜æ²¡æœ‰æ·»åŠ æ¥¼ç›˜ã€‚<br>è¯·åœ¨æ¥¼ç›˜è¯¦æƒ…é¡µç‚¹å‡»"+ åŠ å…¥æŠ¥å‘Š"
</p>`;
                return;
            }

            reportCart.forEach(key => {
                const [r, s, p] = key.split('|');
                const item = document.createElement('div');
                item.className = 'cart-item';
                item.innerHTML = `
                <div><strong>${p}</strong> <span style="font-size:12px; color:#666;">(${r}-${s})</span></div>
                <div class="btn-delete" onclick="removeFromCart('${key}')">åˆ é™¤</div>
            `;
                list.appendChild(item);
            });
        }

        function closeCart() {
            document.getElementById('cartModal').classList.remove('active');
        }

        // === ä¸‹è½½é€‰é¡¹ç›¸å…³å‡½æ•° ===
        function showDownloadOptions() {
            // æ£€æŸ¥æ˜¯å¦æœ‰é€‰ä¸­çš„æ¥¼ç›˜
            if (reportCart.size === 0) {
                alert('è¯·å…ˆæ·»åŠ æ¥¼ç›˜åˆ°æŠ¥å‘Šä¸­ï¼\n\nç‚¹å‡»æ¥¼ç›˜è¯¦æƒ…é¡µçš„"åŠ å…¥æŠ¥å‘Š"æŒ‰é’®å³å¯æ·»åŠ ã€‚');
                return;
            }
            document.getElementById('downloadModal').style.display = 'flex';
        }

        function closeDownloadModal() {
            document.getElementById('downloadModal').style.display = 'none';
        }

        // ç”Ÿæˆåˆ†äº«é“¾æ¥
        function generateShareLink() {
            if (reportCart.size === 0) {
                alert('è¯·å…ˆæ·»åŠ æ¥¼ç›˜åˆ°æŠ¥å‘Šä¸­ï¼');
                return;
            }

            // é™åˆ¶åˆ†äº«é“¾æ¥æœ€å¤š10ä¸ªæ¥¼ç›˜
            if (reportCart.size > MAX_SHARE_PROJECTS) {
                alert(`åˆ†äº«é“¾æ¥æœ€å¤šæ”¯æŒ ${MAX_SHARE_PROJECTS} ä¸ªæ¥¼ç›˜ï¼\n\nå½“å‰å·²é€‰ ${reportCart.size} ä¸ªï¼Œè¯·åˆ é™¤ ${reportCart.size - MAX_SHARE_PROJECTS} ä¸ªåå†è¯•ã€‚\n\nå»ºè®®ï¼šå°†æ¥¼ç›˜åˆ†æˆå¤šä¸ªæŠ¥å‘Šåˆ†äº«ã€‚`);
                return;
            }

            closeDownloadModal();

            // å°†é€‰ä¸­çš„é¡¹ç›®ç¼–ç åˆ°URLä¸­
            const projects = Array.from(reportCart);
            const encoded = btoa(encodeURIComponent(JSON.stringify(projects)));

            // ç”Ÿæˆåˆ†äº«é“¾æ¥
            const shareUrl = window.location.origin + window.location.pathname + '?share=' + encoded;

            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(shareUrl).then(() => {
                    showToast(`âœ… åˆ†äº«é“¾æ¥å·²å¤åˆ¶ï¼ï¼ˆ${reportCart.size}ä¸ªæ¥¼ç›˜ï¼‰\n\nå‘é€ç»™å®¢æˆ·åï¼Œä»–ä»¬åªèƒ½çœ‹åˆ°ä½ é€‰ä¸­çš„é¡¹ç›®`);
                }).catch(() => fallbackCopy(shareUrl));
            } else {
                fallbackCopy(shareUrl);
            }
        }

        // æ£€æŸ¥å¹¶åŠ è½½åˆ†äº«çš„é“¾æ¥
        function loadSharedProjects() {
            const params = new URLSearchParams(window.location.search);
            const shareData = params.get('share');

            if (shareData) {
                try {
                    const projects = JSON.parse(decodeURIComponent(atob(shareData)));

                    // P0-2ä¿®å¤ï¼šè®¾ç½®åˆ†äº«æ¨¡å¼æ ‡è®°ï¼Œä½¿ç”¨ç‹¬ç«‹æ•°æ®ï¼Œä¸å½±å“localStorage
                    isShareMode = true;

                    // åˆ†äº«æ¨¡å¼ä½¿ç”¨ç‹¬ç«‹çš„è´­ç‰©è½¦æ•°æ®ï¼ˆä¸æ¸…ç©ºç”¨æˆ·åŸæœ‰æ•°æ®ï¼‰
                    reportCart = new Set(projects);

                    // å½»åº•éšè—ä¾§è¾¹æ å’Œèœå•
                    const sidebar = document.getElementById('sidebar');
                    const menuToggle = document.querySelector('.menu-toggle');
                    const floatingBall = document.querySelector('.floating-ball');

                    if (sidebar) sidebar.style.display = 'none';
                    if (menuToggle) menuToggle.style.display = 'none';
                    if (floatingBall) floatingBall.style.display = 'none';

                    document.querySelector('.content-wrapper').style.marginLeft = '0';
                    document.querySelector('.content-wrapper').style.maxWidth = '100%';

                    // æ˜¾ç¤ºåˆ†äº«æç¤º
                    const shareNotice = document.createElement('div');
                    shareNotice.id = 'shareNotice';
                    shareNotice.style.cssText = 'position:fixed;top:0;left:0;right:0;background:#2e86c1;color:white;padding:15px;text-align:center;z-index:10000;font-size:14px;';
                    shareNotice.innerHTML = 'ğŸ“¢ è¿™æ˜¯è´å£³æé‡‘æ¾ä¸ºæ‚¨ç²¾é€‰çš„æ¥¼ç›˜æ¨è <span style="margin-left:20px;cursor:pointer;" onclick="document.getElementById(\'shareNotice\').remove()">Ã—</span>';
                    document.body.appendChild(shareNotice);

                    // è‡ªåŠ¨æ‰“å¼€ç¬¬ä¸€ä¸ªé¡¹ç›®
                    if (projects.length > 0) {
                        const [region, sub, proj] = projects[0].split('|');
                        loadContent(region, sub, proj, '', '');
                    }

                    showToast('âœ¨ å·²åŠ è½½ ' + projects.length + ' ä¸ªç²¾é€‰æ¥¼ç›˜');
                } catch (e) {
                    console.error('åŠ è½½åˆ†äº«å†…å®¹å¤±è´¥:', e);
                    alert('åˆ†äº«é“¾æ¥æ— æ•ˆæˆ–å·²è¿‡æœŸ');
                }
            }
        }

        // ========== PDFå¯¼å‡ºæ¨¡å—ï¼ˆhtml2canvas + jsPDF æ–¹æ¡ˆï¼‰==========

        // å®¢æˆ·åç§°è¾“å…¥å¼¹çª—
        function showClientNameInput() {
            if (reportCart.size === 0) {
                alert('è¯·å…ˆæ·»åŠ æ¥¼ç›˜åˆ°æŠ¥å‘Šä¸­ï¼');
                return;
            }

            const clientName = prompt('è¯·è¾“å…¥å®¢æˆ·å§“åï¼ˆç”¨äºæŠ¥å‘Šå‘½åï¼‰ï¼š', 'å°Šè´µå®¢æˆ·');
            if (clientName === null) return; // ç”¨æˆ·å–æ¶ˆ

            closeDownloadModal();
            generatePDF(clientName || 'å°Šè´µå®¢æˆ·');
        }

        // ç”ŸæˆPDFæŠ¥å‘Šï¼ˆå®Œå…¨é‡æ„ç‰ˆ - å·²é€šè¿‡QAè‡ªæµ‹ï¼‰
        async function generatePDF(clientName) {
            // æ£€æŸ¥jsPDFåº“æ˜¯å¦åŠ è½½
            if (!window.jspdf || !window.jspdf.jsPDF) {
                alert('PDFç”Ÿæˆåº“æœªåŠ è½½å®Œæˆï¼Œè¯·åˆ·æ–°é¡µé¢åé‡è¯•\n\næˆ–ä½¿ç”¨"ç”Ÿæˆåˆ†äº«é“¾æ¥"åŠŸèƒ½');
                return;
            }

            const { jsPDF } = window.jspdf;

            // æ£€æµ‹ç¯å¢ƒ
            const isWeChat = /MicroMessenger/i.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);

            // å®‰å…¨æˆªæ–­å‡½æ•°ï¼ˆé˜²æ­¢æ–‡æœ¬è¶…å‡ºï¼‰
            const safeText = (text, maxLen) => {
                if (!text) return '';
                return text.length > maxLen ? text.substring(0, maxLen - 2) + '...' : text;
            };

            // æ˜¾ç¤ºé«˜çº§åŠ è½½åŠ¨ç”»
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'pdfLoadingOverlay';
            loadingOverlay.innerHTML = `
                <div style="position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:99999;display:flex;flex-direction:column;align-items:center;justify-content:center;">
                    <div style="width:60px;height:60px;border:4px solid #333;border-top-color:#2e86c1;border-radius:50%;animation:spin 1s linear infinite;"></div>
                    <div id="pdfLoadingText" style="color:white;font-size:18px;margin-top:25px;text-align:center;">æ­£åœ¨æ’ç‰ˆä¸­ï¼Œè¯·å‹¿å…³é—­é¡µé¢...</div>
                    <div id="pdfLoadingProgress" style="color:#888;font-size:14px;margin-top:10px;">å‡†å¤‡ç”ŸæˆæŠ¥å‘Š</div>
                    <style>@keyframes spin{to{transform:rotate(360deg)}}</style>
                </div>
            `;
            document.body.appendChild(loadingOverlay);

            const updateProgress = (text) => {
                const el = document.getElementById('pdfLoadingProgress');
                if (el) el.textContent = text;
            };

            try {
                // è·å–é€‰ä¸­çš„æ¥¼ç›˜æ•°æ®
                const projects = [];
                reportCart.forEach(key => {
                    const [region, sub, proj] = key.split('|');
                    const projData = (db[region] && db[region][sub] && db[region][sub][proj]) || {};
                    projects.push({
                        key,
                        region,
                        sub,
                        name: proj,
                        peitao: projData.peitao || '',
                        huxing: projData.huxing || ''
                    });
                });

                updateProgress('æ­£åœ¨åˆ›å»ºPDFæ–‡æ¡£...');

                // åˆ›å»ºPDFæ–‡æ¡£ (A4å°ºå¯¸)
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });

                const pageWidth = 210;
                const pageHeight = 297;
                const margin = 15;
                const contentWidth = pageWidth - margin * 2;

                const today = new Date();
                const dateStr = today.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });
                const fileDate = today.toISOString().slice(0, 10).replace(/-/g, '');

                // ========== ç¬¬ä¸€é¡µï¼šå°é¢ ==========
                updateProgress('æ­£åœ¨ç”Ÿæˆå°é¢...');

                // å°é¢èƒŒæ™¯æ¸å˜æ•ˆæœï¼ˆç”¨çŸ©å½¢æ¨¡æ‹Ÿï¼‰
                pdf.setFillColor(45, 49, 66);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');

                // è£…é¥°çº¿æ¡
                pdf.setDrawColor(46, 134, 193);
                pdf.setLineWidth(2);
                pdf.line(margin, 60, pageWidth - margin, 60);
                pdf.line(margin, 230, pageWidth - margin, 230);

                // ä¸»æ ‡é¢˜
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(28);
                pdf.text('æ·±åœ³æ–°æˆ¿é¡¹ç›®', pageWidth / 2, 100, { align: 'center' });
                pdf.text('ä¸“å±å®šåˆ¶æŠ¥å‘Š', pageWidth / 2, 115, { align: 'center' });

                // å‰¯æ ‡é¢˜
                pdf.setFontSize(14);
                pdf.setTextColor(46, 134, 193);
                pdf.text('SHENZHEN NEW PROPERTY REPORT', pageWidth / 2, 135, { align: 'center' });

                // å®¢æˆ·ä¿¡æ¯ï¼ˆé™åˆ¶é•¿åº¦é˜²æ­¢è¶…å‡ºï¼‰
                pdf.setFontSize(16);
                pdf.setTextColor(255, 255, 255);
                const safeClientName = safeText(clientName, 15);
                pdf.text(`å°Šæ•¬çš„ ${safeClientName}`, pageWidth / 2, 165, { align: 'center' });

                // æŠ¥å‘Šä¿¡æ¯
                pdf.setFontSize(12);
                pdf.setTextColor(200, 200, 200);
                pdf.text(`æœ¬æŠ¥å‘ŠåŒ…å« ${projects.length} ä¸ªç²¾é€‰æ¥¼ç›˜`, pageWidth / 2, 180, { align: 'center' });
                pdf.text(`ç”Ÿæˆæ—¥æœŸï¼š${dateStr}`, pageWidth / 2, 190, { align: 'center' });

                // ç½®ä¸šé¡¾é—®ä¿¡æ¯
                pdf.setFontSize(14);
                pdf.setTextColor(255, 255, 255);
                pdf.text('æ‚¨çš„ä¸“å±ç½®ä¸šé¡¾é—®', pageWidth / 2, 245, { align: 'center' });
                pdf.setFontSize(18);
                pdf.setTextColor(46, 134, 193);
                pdf.text('æé‡‘æ¾', pageWidth / 2, 258, { align: 'center' });
                pdf.setFontSize(12);
                pdf.setTextColor(200, 200, 200);
                pdf.text('ç”µè¯/å¾®ä¿¡ï¼š17277898972', pageWidth / 2, 270, { align: 'center' });

                // å…è´£å£°æ˜
                pdf.setFontSize(8);
                pdf.setTextColor(120, 120, 120);
                pdf.text('æœ¬æŠ¥å‘Šä»…ä¾›å‚è€ƒï¼Œå…·ä½“ä¿¡æ¯ä»¥å¼€å‘å•†å…¬ç¤ºä¸ºå‡†', pageWidth / 2, 290, { align: 'center' });

                // ========== ç¬¬äºŒé¡µï¼šæ¥¼ç›˜å¯¹æ¯”ç›®å½• ==========
                updateProgress('æ­£åœ¨ç”Ÿæˆå¯¹æ¯”ç›®å½•...');
                pdf.addPage();

                // é¡µé¢èƒŒæ™¯
                pdf.setFillColor(255, 255, 255);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');

                // æ ‡é¢˜
                pdf.setFillColor(45, 49, 66);
                pdf.rect(0, 0, pageWidth, 40, 'F');
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(20);
                pdf.text('æ¥¼ç›˜å¯¹æ¯”æ¸…å•', pageWidth / 2, 25, { align: 'center' });

                // è¡¨æ ¼æ ‡é¢˜è¡Œ
                let tableY = 55;
                pdf.setFillColor(46, 134, 193);
                pdf.rect(margin, tableY, contentWidth, 12, 'F');
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(11);
                pdf.text('æ¥¼ç›˜åç§°', margin + 5, tableY + 8);
                pdf.text('åŒºåŸŸ', margin + 70, tableY + 8);
                pdf.text('æ¿å—', margin + 105, tableY + 8);
                pdf.text('åºå·', margin + 155, tableY + 8);

                // è¡¨æ ¼å†…å®¹ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
                tableY += 12;
                const maxRowsPerPage = 20; // æ¯é¡µæœ€å¤šæ˜¾ç¤º20ä¸ªæ¥¼ç›˜

                projects.forEach((proj, index) => {
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦æ¢é¡µ
                    if (index > 0 && index % maxRowsPerPage === 0) {
                        pdf.addPage();
                        pdf.setFillColor(255, 255, 255);
                        pdf.rect(0, 0, pageWidth, pageHeight, 'F');

                        // ç»­è¡¨æ ‡é¢˜
                        pdf.setFillColor(45, 49, 66);
                        pdf.rect(0, 0, pageWidth, 30, 'F');
                        pdf.setTextColor(255, 255, 255);
                        pdf.setFontSize(16);
                        pdf.text('æ¥¼ç›˜å¯¹æ¯”æ¸…å•ï¼ˆç»­ï¼‰', pageWidth / 2, 20, { align: 'center' });

                        tableY = 45;
                        // é‡ç»˜è¡¨å¤´
                        pdf.setFillColor(46, 134, 193);
                        pdf.rect(margin, tableY, contentWidth, 12, 'F');
                        pdf.setTextColor(255, 255, 255);
                        pdf.setFontSize(11);
                        pdf.text('æ¥¼ç›˜åç§°', margin + 5, tableY + 8);
                        pdf.text('åŒºåŸŸ', margin + 70, tableY + 8);
                        pdf.text('æ¿å—', margin + 105, tableY + 8);
                        pdf.text('åºå·', margin + 155, tableY + 8);
                        tableY += 12;
                    }

                    const rowColor = index % 2 === 0 ? 248 : 255;
                    pdf.setFillColor(rowColor, rowColor, rowColor);
                    pdf.rect(margin, tableY, contentWidth, 10, 'F');

                    pdf.setTextColor(51, 51, 51);
                    pdf.setFontSize(10);
                    pdf.text(safeText(proj.name, 12), margin + 5, tableY + 7);
                    pdf.text(safeText(proj.region, 8), margin + 70, tableY + 7);
                    pdf.text(safeText(proj.sub, 6), margin + 105, tableY + 7);

                    // è®¡ç®—å®é™…é¡µç ï¼ˆè€ƒè™‘ç›®å½•å¯èƒ½å å¤šé¡µï¼‰
                    const tocPages = Math.ceil(projects.length / maxRowsPerPage);
                    const actualPage = index + 2 + tocPages;
                    pdf.text(`ç¬¬${actualPage}é¡µ`, margin + 155, tableY + 7);

                    tableY += 10;
                });

                // è¡¨æ ¼è¾¹æ¡†
                pdf.setDrawColor(200, 200, 200);
                pdf.setLineWidth(0.5);
                pdf.rect(margin, 55, contentWidth, tableY - 55);

                // åº•éƒ¨è¯´æ˜
                pdf.setFontSize(10);
                pdf.setTextColor(150, 150, 150);
                pdf.text('* ä»¥ä¸‹ä¸ºå„æ¥¼ç›˜è¯¦ç»†ä¿¡æ¯ï¼Œè¯·ç¿»é¡µæŸ¥çœ‹', pageWidth / 2, tableY + 20, { align: 'center' });

                // ========== åç»­é¡µï¼šæ¥¼ç›˜è¯¦æƒ… ==========
                const tocPages = Math.ceil(projects.length / maxRowsPerPage);
                const totalPages = 1 + tocPages + projects.length + 1; // å°é¢ + ç›®å½• + è¯¦æƒ… + åç‰‡

                for (let i = 0; i < projects.length; i++) {
                    const proj = projects[i];
                    updateProgress(`æ­£åœ¨ç”Ÿæˆæ¥¼ç›˜è¯¦æƒ… (${i + 1}/${projects.length})...`);

                    pdf.addPage();

                    const currentPage = 1 + tocPages + i + 1; // å½“å‰é¡µç 

                    // é¡µçœ‰
                    pdf.setFillColor(45, 49, 66);
                    pdf.rect(0, 0, pageWidth, 25, 'F');
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFontSize(12);
                    pdf.text(`${safeText(proj.region, 6)} Â· ${safeText(proj.sub, 8)}`, margin, 16);
                    pdf.setFontSize(10);
                    pdf.text(`${currentPage} / ${totalPages}`, pageWidth - margin, 16, { align: 'right' });

                    // æ¥¼ç›˜åç§°ï¼ˆé™åˆ¶é•¿åº¦ï¼Œè¶…é•¿è‡ªåŠ¨æ¢è¡Œï¼‰
                    pdf.setTextColor(45, 49, 66);
                    pdf.setFontSize(20);
                    const projNameLines = pdf.splitTextToSize(proj.name, contentWidth);
                    let nameY = 42;
                    projNameLines.slice(0, 2).forEach(line => {
                        pdf.text(line, margin, nameY);
                        nameY += 10;
                    });

                    // åˆ†éš”çº¿
                    pdf.setDrawColor(46, 134, 193);
                    pdf.setLineWidth(1);
                    pdf.line(margin, nameY, margin + 60, nameY);

                    // æå–çº¯æ–‡æœ¬å†…å®¹
                    const peitaoText = proj.peitao.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();
                    const huxingText = proj.huxing.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim();

                    let currentY = nameY + 15; // æ ¹æ®æ¥¼ç›˜åç§°ä½ç½®åŠ¨æ€è°ƒæ•´

                    // é¡¹ç›®é…å¥—
                    pdf.setFillColor(240, 247, 255);
                    pdf.rect(margin, currentY - 5, contentWidth, 12, 'F');
                    pdf.setTextColor(46, 134, 193);
                    pdf.setFontSize(14);
                    pdf.text('é¡¹ç›®é…å¥—', margin + 5, currentY + 4);
                    currentY += 15;

                    // é…å¥—å†…å®¹ï¼ˆè‡ªåŠ¨æ¢è¡Œï¼‰
                    pdf.setTextColor(80, 80, 80);
                    pdf.setFontSize(10);
                    const peitaoContent = peitaoText || 'æš‚æ— é…å¥—ä¿¡æ¯ï¼Œè¯·å’¨è¯¢ç½®ä¸šé¡¾é—®è·å–æœ€æ–°èµ„æ–™';
                    const peitaoLines = pdf.splitTextToSize(peitaoContent.substring(0, 1200), contentWidth - 10);
                    const maxPeitaoLines = Math.min(peitaoLines.length, 15);
                    for (let j = 0; j < maxPeitaoLines; j++) {
                        pdf.text(peitaoLines[j], margin + 5, currentY);
                        currentY += 5;
                    }
                    if (peitaoLines.length > 15) {
                        pdf.text('...ï¼ˆæ›´å¤šè¯¦æƒ…è¯·å’¨è¯¢ç½®ä¸šé¡¾é—®ï¼‰', margin + 5, currentY);
                        currentY += 5;
                    }

                    currentY += 10;

                    // æˆ·å‹ä»‹ç»
                    if (currentY < 200) {
                        pdf.setFillColor(255, 245, 238);
                        pdf.rect(margin, currentY - 5, contentWidth, 12, 'F');
                        pdf.setTextColor(231, 76, 60);
                        pdf.setFontSize(14);
                        pdf.text('æˆ·å‹ä»‹ç»', margin + 5, currentY + 4);
                        currentY += 15;

                        pdf.setTextColor(80, 80, 80);
                        pdf.setFontSize(10);
                        const huxingContent = huxingText || 'æš‚æ— æˆ·å‹ä¿¡æ¯ï¼Œè¯·å’¨è¯¢ç½®ä¸šé¡¾é—®è·å–æœ€æ–°èµ„æ–™';
                        const huxingLines = pdf.splitTextToSize(huxingContent.substring(0, 800), contentWidth - 10);
                        const maxHuxingLines = Math.min(huxingLines.length, 12);
                        for (let j = 0; j < maxHuxingLines; j++) {
                            if (currentY > 270) break;
                            pdf.text(huxingLines[j], margin + 5, currentY);
                            currentY += 5;
                        }
                    }

                    // é¡µè„šæ°´å°
                    pdf.setFontSize(8);
                    pdf.setTextColor(180, 180, 180);
                    pdf.text('è´å£³æ‰¾æˆ¿ Â· æé‡‘æ¾ Â· 17277898972', pageWidth / 2, 290, { align: 'center' });
                }

                // ========== æœ«é¡µï¼šä¸“å±åç‰‡ ==========
                updateProgress('æ­£åœ¨ç”Ÿæˆä¸“å±åç‰‡...');
                pdf.addPage();

                // èƒŒæ™¯
                pdf.setFillColor(45, 49, 66);
                pdf.rect(0, 0, pageWidth, pageHeight, 'F');

                // æ„Ÿè°¢è¯­
                pdf.setTextColor(255, 255, 255);
                pdf.setFontSize(24);
                pdf.text('æ„Ÿè°¢æ‚¨çš„ä¿¡ä»»', pageWidth / 2, 80, { align: 'center' });

                pdf.setFontSize(16);
                pdf.setTextColor(46, 134, 193);
                pdf.text('ä¸ºæ‚¨å¯»æ‰¾ç†æƒ³çš„å®¶', pageWidth / 2, 100, { align: 'center' });

                // åç‰‡åŒºåŸŸ
                pdf.setFillColor(255, 255, 255);
                pdf.roundedRect(margin + 20, 130, contentWidth - 40, 80, 5, 5, 'F');

                pdf.setTextColor(45, 49, 66);
                pdf.setFontSize(20);
                pdf.text('æé‡‘æ¾', pageWidth / 2, 155, { align: 'center' });

                pdf.setFontSize(12);
                pdf.setTextColor(100, 100, 100);
                pdf.text('è´å£³æ‰¾æˆ¿ Â· èµ„æ·±ç½®ä¸šé¡¾é—®', pageWidth / 2, 170, { align: 'center' });

                pdf.setFontSize(14);
                pdf.setTextColor(46, 134, 193);
                pdf.text('17277898972', pageWidth / 2, 190, { align: 'center' });

                pdf.setFontSize(10);
                pdf.setTextColor(150, 150, 150);
                pdf.text('å¾®ä¿¡åŒå· Â· éšæ—¶ä¸ºæ‚¨æœåŠ¡', pageWidth / 2, 200, { align: 'center' });

                // æœåŠ¡æ‰¿è¯º
                pdf.setTextColor(200, 200, 200);
                pdf.setFontSize(11);
                const promises = [
                    'âœ“ å…¨ç¨‹å…è´¹å¸¦çœ‹ï¼Œæ— ä»»ä½•éšå½¢è´¹ç”¨',
                    'âœ“ é¢„çº¦çœ‹æˆ¿äº«ä¸“å±æŠ˜æ‰£ï¼ˆæ€»ä»·ä¸€ä¸ªç‚¹èµ·ï¼‰',
                    'âœ“ ä¸“ä¸šåˆ†æï¼Œå¸®æ‚¨é€‰åˆ°æœ€é€‚åˆçš„æˆ¿å­',
                    'âœ“ ä¸€å¯¹ä¸€æœåŠ¡ï¼Œå…¨ç¨‹é™ªåŒç›´è‡³äº¤æˆ¿'
                ];
                let promiseY = 235;
                promises.forEach(p => {
                    pdf.text(p, pageWidth / 2, promiseY, { align: 'center' });
                    promiseY += 12;
                });

                // ========== ä¿å­˜PDF ==========
                updateProgress('æ­£åœ¨ä¿å­˜æ–‡ä»¶...');

                const fileName = `${clientName}ä¸“å±_æ·±åœ³æ–°æˆ¿å¯¹æ¯”æŠ¥å‘Š_${fileDate}.pdf`;
                pdf.save(fileName);

                // ç§»é™¤åŠ è½½åŠ¨ç”»
                loadingOverlay.remove();
                showToast(`âœ… PDFå·²ç”Ÿæˆï¼\n\næ–‡ä»¶åï¼š${fileName}`);

            } catch (error) {
                console.error('PDFç”Ÿæˆå¤±è´¥:', error);

                // ç§»é™¤åŠ è½½åŠ¨ç”»
                if (document.getElementById('pdfLoadingOverlay')) {
                    document.getElementById('pdfLoadingOverlay').remove();
                }

                // å‹å¥½çš„é”™è¯¯æç¤º
                const errorMsg = isWeChat || isIOS
                    ? 'å½“å‰ç¯å¢ƒé™åˆ¶å¯¼å‡ºï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼Œè¯·å¤åˆ¶åˆ°æµè§ˆå™¨ä¸‹è½½æˆ–å’¨è¯¢æŠ€æœ¯æ”¯æŒ'
                    : 'PDFç”Ÿæˆå¤±è´¥ï¼Œå»ºè®®ä½¿ç”¨"ç”Ÿæˆåˆ†äº«é“¾æ¥"åŠŸèƒ½';

                if (confirm(errorMsg + '\n\næ˜¯å¦ç«‹å³ç”Ÿæˆåˆ†äº«é“¾æ¥ï¼Ÿ')) {
                    generateShareLink();
                }
            }
        }

        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•ï¼ˆå…¼å®¹æ—§æµè§ˆå™¨ï¼‰
        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();

            try {
                document.execCommand('copy');
                showToast('âœ… åˆ†äº«é“¾æ¥å·²å¤åˆ¶ï¼\n\nå‘é€ç»™å®¢æˆ·åï¼Œä»–ä»¬åªèƒ½çœ‹åˆ°ä½ é€‰ä¸­çš„é¡¹ç›®');
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showToast('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯•');
            }

            document.body.removeChild(textarea);
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);color:white;padding:15px 25px;border-radius:10px;z-index:10003;font-size:14px;max-width:80%;text-align:center;white-space:pre-line;animation:fadeIn 0.3s;';
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // === iOSæµè§ˆå™¨å¼•å¯¼ ===
        // æ£€æµ‹æ˜¯å¦åœ¨å¾®ä¿¡æˆ–åº”ç”¨å†…
        function isInApp() {
            const ua = navigator.userAgent.toLowerCase();
            return ua.indexOf('micromessenger') !== -1 || ua.indexOf('qq') !== -1;
        }

        // æ˜¾ç¤ºiOSæµè§ˆå™¨å¼•å¯¼
        function showiOSGuide() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            if (isIOS && isInApp()) {
                // æ·»åŠ ä¸€ä¸ªæç¤ºæŒ‰é’®åˆ°é¡µé¢é¡¶éƒ¨
                const guideBtn = document.createElement('div');
                guideBtn.id = 'iosGuideBtn';
                guideBtn.style.cssText = 'position:fixed;top:0;left:0;right:0;background:#ff9800;color:white;text-align:center;padding:10px;font-size:14px;z-index:9999;cursor:pointer;';
                guideBtn.innerHTML = 'ğŸ“± å»ºè®®ä½¿ç”¨Safariæµè§ˆå™¨è·å¾—æœ€ä½³ä½“éªŒï¼Œç‚¹å‡»æŸ¥çœ‹';
                guideBtn.onclick = function() {
                    document.getElementById('iosGuide').style.display = 'block';
                };
                document.body.appendChild(guideBtn);

                // ç‚¹å‡»é®ç½©å…³é—­
                document.getElementById('iosGuide').onclick = function() {
                    this.style.display = 'none';
                };
            }
        }

        // --- æ ¸å¿ƒä¼˜åŒ–ï¼šå¸¦æ°´å°ã€å®½ç»°æ’ç‰ˆã€ä¸‰å±‚æŠ˜å æŠ¥å‘Šç”Ÿæˆå™¨ ---
        function generateReport() {
            if (reportCart.size === 0) return alert('è¯·å…ˆæ·»åŠ æ¥¼ç›˜ï¼');

            let reportContent = '';
            const today = new Date().toLocaleDateString();

            // 1. å¾ªç¯æ„å»ºæ¥¼ç›˜å†…å®¹ (ä¸‰å±‚ç»“æ„)
            reportCart.forEach(key => {
                const [region, sub, proj] = key.split('|');
                const projData = db[region][sub][proj] || {};

                const peitao = projData.peitao && projData.peitao.trim() !== '' ? projData.peitao : `<p style="color:#999;">æš‚æ— é…å¥—ä¿¡æ¯</p>`;
                const huxing = projData.huxing && projData.huxing.trim() !== '' ? projData.huxing : `<p style="color:#999;">æš‚æ— æˆ·å‹ä¿¡æ¯</p>`;

                reportContent += `
        <div class="proj-group">
            <div class="btn-l1" onclick="toggleBox(this)">
                <span class="title">ğŸ¢ ${proj}</span>
                <span class="icon">ï¼‹</span>
            </div>
            <div class="content-l1" style="display:none;">
                
                <div class="category-box">
                    <div class="btn-l2" onclick="toggleBox(this)">
                        <span>ğŸ“ é¡¹ç›®é…å¥—</span>
                        <span class="icon">ï¼‹</span>
                    </div>
                    <div class="content-l2" style="display:none;">
                        <div class="article-body">${peitao}</div>
                    </div>
                </div>

                <div class="category-box">
                    <div class="btn-l2" onclick="toggleBox(this)">
                        <span>ğŸ  æˆ·å‹ä»‹ç»</span>
                        <span class="icon">ï¼‹</span>
                    </div>
                    <div class="content-l2" style="display:none;">
                        <div class="article-body">${huxing}</div>
                    </div>
                </div>

            </div>
        </div>`;
            });

            const rTitle = 'VIP ä¸“å±ç½®ä¸šæŠ¥å‘Š';
            const rAdvisor = 'ä¸“å±é¡¾é—®ï¼šè´å£³æé‡‘æ¾';
            const rPhone = 'ç”µè¯/å¾®ä¿¡ï¼š17277898972';
            const rDiscount = 'é¢„çº¦çœ‹æˆ¿é¢†ä¸“å±æŠ˜æ‰£ï¼ˆæ€»ä»·çš„ä¸€ä¸ªç‚¹èµ·ï¼‰';
            const rDate = 'ç”Ÿæˆæ—¥æœŸï¼š';

            // 2. ç”Ÿæˆå®Œæ•´çš„ HTML (åŒ…å«é’ˆå¯¹ç§»åŠ¨ç«¯ä¼˜åŒ–çš„ CSS å’Œæ°´å°è„šæœ¬)
            const htmlTemplate = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>${rTitle}</title>
    <style>
        /* === æ¶ˆé™¤æ’ç‰ˆå±€ä¿ƒæ„Ÿï¼šå…¨å±€æ ·å¼ === */
        body { font-family: "Microsoft YaHei", -apple-system, sans-serif; background: #f4f6f9; margin: 0; padding: 25px 15px; color: #333; line-height: 1.8; }
        .report-wrapper { max-width: 700px; margin: 0 auto; position: relative; z-index: 10; }
        
        /* === å¤´éƒ¨ï¼šåŠ æ·±è§†è§‰æ·±åº¦ === */
        .report-header { background: #fff; padding: 40px 20px; border-radius: 20px; text-align: center; box-shadow: 0 12px 30px rgba(0,0,0,0.06); margin-bottom: 30px; border-top: 8px solid #2e86c1; }
        .report-header h1 { color: #1a5276; margin: 0 0 15px; font-size: 26px; font-weight: 800; letter-spacing: 1px; }
        .info-pill { background: #f0f7fd; padding: 18px 25px; border-radius: 60px; display: inline-block; border: 1px solid #d0e8f9; }
        .discount-highlight { color: #e74c3c; font-weight: bold; font-size: 14px; display: block; margin-top: 8px; }

        /* === ç¬¬ä¸€å±‚ï¼šé¡¹ç›®å¡ç‰‡ (å¢åŠ é—´è·) === */
        .proj-group { background: #fff; border-radius: 18px; margin-bottom: 25px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.04); }
        .btn-l1 { padding: 24px 20px; background: #fff; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #f2f2f2; }
        .btn-l1 .title { font-size: 20px; font-weight: bold; color: #2c3e50; }
        .content-l1 { background: #fafafa; padding: 15px; }

        /* === ç¬¬äºŒå±‚ï¼šåˆ†ç±»å— (å¢åŠ å‘¼å¸æ„Ÿ) === */
        .category-box { margin-bottom: 15px; border-radius: 14px; overflow: hidden; border: 1px solid #eee; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.02); }
        .btn-l2 { padding: 18px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-size: 16px; font-weight: 600; color: #555; }
        .content-l2 { border-top: 1px dashed #f0f0f0; }

        /* === ç¬¬ä¸‰å±‚ï¼šå†…å®¹æ­£æ–‡ (ä¼˜åŒ–æ’ç‰ˆ) === */
        .article-body { padding: 25px 20px; font-size: 15px; color: #444; word-wrap: break-word; }
        .article-body p { margin-bottom: 18px; text-align: justify; }
        .article-body table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 14px; background: #fff; }
        .article-body th, .article-body td { border: 1px solid #eee; padding: 14px 10px; text-align: left; }
        .article-body th { background: #f9f9f9; color: #666; width: 32%; }
        
        /* å¯Œæ–‡æœ¬ä¿®é¥°å— */
        .highlight, .price-comparison, .special-offer, .disadvantages { padding: 20px; border-radius: 10px; margin: 25px 0; border-left: 6px solid #ccc; font-size: 14px; }
        .highlight { border-color: #2e86c1; background: #f1f9ff; }
        .special-offer { border-color: #27ae60; background: #f2fff6; }
        .disadvantages { border-color: #e74c3c; background: #fff7f7; }

        /* äº¤äº’å°æ ‡ */
        .icon { color: #ccc; font-size: 20px; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .active .icon { transform: rotate(45deg); color: #2e86c1; }

        /* === æ°´å°æ ·å¼ === */
        .wm-layer { position: fixed; inset: 0; pointer-events: none; z-index: 1; display: flex; flex-wrap: wrap; justify-content: center; align-content: center; overflow: hidden; opacity: 0.07; }
        .wm-item { transform: rotate(-25deg); font-size: 14px; color: #000; font-weight: bold; margin: 60px 40px; width: 300px; text-align: center; white-space: pre-wrap; line-height: 1.5; }

        /* æ‰‹æœºè¶…å°å±é€‚é… */
        @media (max-width: 400px) {
            body { padding: 15px 10px; }
            .report-header { padding: 30px 15px; }
            .btn-l1 .title { font-size: 18px; }
        }
    </style>
</head>
<body>
    <div class="wm-layer" id="wm"></div>

    <div class="report-wrapper">
        <div class="report-header">
            <h1>${rTitle}</h1>
            <div class="info-pill">
                <strong>ğŸ‘¤ ${rAdvisor}</strong><br>
                ğŸ“ ${rPhone}
                <span class="discount-highlight">${rDiscount}</span>
            </div>
            <p style="color:#999; font-size:12px; margin-top:25px;">${rDate}${today}</p>
        </div>
        
        ${reportContent}
        
        <div style="text-align:center; color:#bdc3c7; font-size:12px; padding: 45px 20px;">
            Â© è´å£³æ‰¾æˆ¿ - ${rAdvisor} ä¸“å±å®šåˆ¶æŠ¥å‘Š
        </div>
    </div>

    <script>
        // æ ¸å¿ƒäº¤äº’é€»è¾‘ï¼šä¸‰å±‚æŠ˜å æ§åˆ¶
        function toggleBox(btn) {
            btn.classList.toggle('active');
            var content = btn.nextElementSibling;
            if (content.style.display === "none") {
                content.style.display = "block";
            } else {
                content.style.display = "none";
            }
        }

        // æ°´å°æ³¨å…¥é€»è¾‘
        function drawWatermark() {
            const container = document.getElementById('wm');
            // æ­¤å¤„ä¿æŒæ‚¨åŸæœ‰çš„æ°´å°æ–‡æ¡ˆå’Œæ¢è¡Œç¬¦
            const text = "è´å£³æé‡‘æ¾17277898972\\né¢„çº¦çœ‹æˆ¿é¢†ä¸“å±æŠ˜æ‰£ï¼ˆæ€»ä»·çš„ä¸€ä¸ªç‚¹èµ·ï¼‰";
            for(let i=0; i<15; i++) {
                const div = document.createElement('div');
                div.className = 'wm-item';
                div.innerText = text.replace('\\\\n', '\\n');
                container.appendChild(div);
            }
        }
        drawWatermark();
    <\/script>
</body>
</html>`;

            // 3. æ‰§è¡Œä¸‹è½½æµç¨‹
            const blob = new Blob([htmlTemplate], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const reportName = 'ä¸“å±ç½®ä¸šæŠ¥å‘Š';
            a.download = reportName + "_" + new Date().getTime() + ".html";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- èœå•ä¸å†…å®¹é€»è¾‘ ---

        function createNode(text, className, parent) {
            const div = document.createElement('div');
            div.className = className;
            div.innerHTML = text;
            parent.appendChild(div);
            return div;
        }

        function createContainer(parent) {
            const div = document.createElement('div');
            div.className = 'nav-group';
            parent.appendChild(div);
            return div;
        }

        // ä¾§è¾¹æ çŠ¶æ€æŒä¹…åŒ–
        function saveSidebarState(region, isOpen) {
            try {
                const state = JSON.parse(localStorage.getItem('sidebarState') || '{}');
                state[region] = isOpen;
                localStorage.setItem('sidebarState', JSON.stringify(state));
            } catch (e) {
                console.error('ä¿å­˜ä¾§è¾¹æ çŠ¶æ€å¤±è´¥:', e);
            }
        }

        function loadSidebarState() {
            try {
                return JSON.parse(localStorage.getItem('sidebarState') || '{}');
            } catch (e) {
                console.error('åŠ è½½ä¾§è¾¹æ çŠ¶æ€å¤±è´¥:', e);
                return {};
            }
        }

        function toggleNode(node, container) {
            node.classList.toggle('open');
            container.classList.toggle('show');

            // ä¿å­˜çŠ¶æ€
            const regionText = node.textContent.trim();
            const isOpen = node.classList.contains('open');
            saveSidebarState(regionText, isOpen);
        }

        function loadContent(region, sub, proj, typeLabel, htmlContent) {
            const area = document.getElementById('contentArea');
            let content;

            // è®°å½•æµè§ˆï¼ˆæ’é™¤ä»·æ ¼åœ°å›¾ï¼‰
            if (proj !== 'ä»·æ ¼åœ°å›¾' && proj !== "ä»·æ ¼åœ°å›¾" && proj !== "ä»·æ ¼æ€»è§ˆ") {
                recordView(region, sub, proj);
            }

            // Check if it's price map (handle both Chinese and English)
            if (proj === 'ä»·æ ¼åœ°å›¾' || proj === "ä»·æ ¼åœ°å›¾" || proj === "ä»·æ ¼æ€»è§ˆ") {
                const priceMapContent = db[region]['_PRICE_MAP'] || `<div class="placeholder">æš‚æ— æ•°æ®</div>`;
                area.innerHTML = `
                <div class="breadcrumb">${region} / ä»·æ ¼åœ°å›¾</div>
                <h1 class="page-header">${region} - ä»·æ ¼æ€»è§ˆ</h1>
                <div class="price-map-container">${priceMapContent}</div>`;
            } else {
                const data = db[region] && db[region][sub] && db[region][sub][proj] ? db[region][sub][proj] : {};
                // Check if it's facilities (handle both Chinese and English labels)
                const isFacilities = typeLabel === 'é¡¹ç›®é…å¥—' || typeLabel === 'é¡¹ç›®é…å¥—' || typeLabel === 'Project Facilities';
                htmlContent = data[isFacilities ? 'peitao' : 'huxing'];

                content = htmlContent && htmlContent.trim() !== '' ? htmlContent : `<div class="placeholder">ç­‰å¾…å½•å…¥...</div>`;

                // P0-1ä¿®å¤ï¼šåœ¨æ¸²æŸ“æ—¶ç›´æ¥æ£€æŸ¥è´­ç‰©è½¦çŠ¶æ€
                const key = `${region}|${sub}|${proj}`;
                const isAdded = reportCart.has(key);
                const btnText = isAdded ? 'å·²åŠ å…¥' : 'â• åŠ å…¥æŠ¥å‘Š';
                const btnClass = isAdded ? "add-to-cart-btn added" : "add-to-cart-btn";
                // P0-3ä¿®å¤ï¼šä½¿ç”¨å®‰å…¨çš„æŒ‰é’®ID
                const btnId = generateBtnId(region, sub, proj);

                // Get translated type label
                const translatedTypeLabel = isFacilities ? 'é¡¹ç›®é…å¥—' : 'æˆ·å‹ä»‹ç»';

                area.innerHTML = `
                <div class="breadcrumb">${region} / ${sub} / ${proj}</div>
                <div style="display:flex; align-items:center; margin-bottom:20px;">
                    <h1 class="page-header" style="margin:0;">${proj} - ${translatedTypeLabel}</h1>
                    <div id="${btnId}" class="${btnClass}" onclick="addToCart('${region}', '${sub}', '${proj}')">${btnText}</div>
                </div>
                <div class="content-body">${content}</div>`;
            }
            document.querySelector('.main-content').scrollTop = 0;
        }

        // --- æœç´¢é€»è¾‘ ---
        function handleSearch(keyword) {
            const navTree = document.getElementById('navTree');
            keyword = keyword.trim().toLowerCase();

            if (!keyword) {
                initMenu();
                return;
            }

            let results = [];
            const regionOrder = ["å—å±±åŒº", "ç¦ç”°åŒº", "å®å®‰åŒº", "é¾™ååŒº", "æ²™äº•", "å…‰æ˜åŒº"];

            regionOrder.forEach(region => {
                if (!db[region]) return;
                const subRegions = db[region];

                if (subRegions._PRICE_MAP && subRegions._PRICE_MAP.toLowerCase().includes(keyword)) {
                    results.push({
                        name: `${region} - ä»·æ ¼æ€»è§ˆ`,
                        path: `${region}`,
                        match: 'åŒ…å«æœç´¢å…³é”®è¯',
                        action: () => loadContent(region, 'ä»·æ ¼åŒºé—´', 'ä»·æ ¼åœ°å›¾', 'ä»·æ ¼æ€»è§ˆ', null)
                    });
                }

                Object.keys(subRegions).forEach(sub => {
                    if (sub === '_PRICE_MAP') return;
                    const projects = subRegions[sub];

                    Object.keys(projects).forEach(proj => {
                        const data = projects[proj];
                        const peitao = (data.peitao || "").toLowerCase();
                        const huxing = (data.huxing || "").toLowerCase();
                        const projName = proj.toLowerCase();
                        const subName = sub.toLowerCase();

                        if (projName.includes(keyword) || subName.includes(keyword) || peitao.includes(keyword) || huxing.includes(keyword)) {
                            let matchText = "";
                            if (peitao.includes(keyword)) matchText = 'åœ¨é…å¥—ä¿¡æ¯ä¸­åŒ¹é…';
                            else if (huxing.includes(keyword)) matchText = 'åœ¨æˆ·å‹ä»‹ç»ä¸­åŒ¹é…';
                            else matchText = 'é¡¹ç›®åç§°åŒ¹é…';

                            results.push({
                                name: proj,
                                path: `${region} / ${sub}`,
                                match: matchText,
                                action: () => loadContent(region, sub, proj, 'é¡¹ç›®é…å¥—', data.peitao)
                            });
                        }
                    });
                });
            });

            navTree.innerHTML = '';
            if (results.length === 0) {
                navTree.innerHTML = `<div style="padding:20px; color:#999; text-align:center;">æ— åŒ¹é…ç»“æœ</div>`;
            } else {
                const header = document.createElement('div');
                header.style.padding = "10px 20px";
                header.style.fontSize = "12px";
                header.style.color = "#999";
                header.innerText = `æ‰¾åˆ° ${results.length} ä¸ªç»“æœ`;
                navTree.appendChild(header);

                results.forEach(item => {
                    const el = document.createElement('div');
                    el.className = 'search-result-item';
                    el.innerHTML = `
                    <div class="search-path">${item.path}</div>
                    <div class="search-name">${item.name}</div>
                    <div class="search-match">${item.match}</div>
                `;
                    el.onclick = () => {
                        item.action();
                        if (window.innerWidth <= 768) toggleMobileMenu();
                        document.querySelectorAll('.search-result-item').forEach(i => i.style.background = '');
                        el.style.background = '#e8f4fc';
                    };
                    navTree.appendChild(el);
                });
            }
        }

        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        }

        // æ˜¾ç¤ºé¡¹ç›®å¡ç‰‡ç½‘æ ¼
        function showProjectCards(region, sub, projects) {
            const area = document.getElementById('contentArea');
            const projectList = Object.keys(projects);

            let cardsHTML = '<div class="project-grid">';
            projectList.forEach(proj => {
                const data = projects[proj];
                cardsHTML += `
                    <div class="project-card">
                        <div class="project-card-title">${proj}</div>
                        <div class="project-card-location">ğŸ“ ${region} Â· ${sub}</div>
                        <div class="project-card-actions">
                            <button class="project-card-btn project-card-btn-primary" onclick="loadContent('${region}', '${sub}', '${proj}', 'é¡¹ç›®é…å¥—', db['${region}']['${sub}']['${proj}'].peitao)">
                                é¡¹ç›®é…å¥—
                            </button>
                            <button class="project-card-btn project-card-btn-secondary" onclick="loadContent('${region}', '${sub}', '${proj}', 'æˆ·å‹ä»‹ç»', db['${region}']['${sub}']['${proj}'].huxing)">
                                æˆ·å‹ä»‹ç»
                            </button>
                        </div>
                    </div>
                `;
            });
            cardsHTML += '</div>';

            area.innerHTML = `
                <div class="breadcrumb">${region} / ${sub}</div>
                <h1 class="page-header">${sub} - æ¥¼ç›˜åˆ—è¡¨</h1>
                ${cardsHTML}
            `;
            document.querySelector('.main-content').scrollTop = 0;
        }

        function initMenu() {
            if (typeof db === 'undefined' || Object.keys(db).length === 0) {
                document.getElementById('contentArea').innerHTML = `<div style="color:red; text-align:center; margin-top:50px;">éœ€åŠ è½½æ•°æ®æ–‡ä»¶ data_core.js</div>`;
                return;
            }

            const navTree = document.getElementById('navTree');
            const regionOrder = ["å—å±±åŒº", "ç¦ç”°åŒº", "å®å®‰åŒº", "é¾™ååŒº", "æ²™äº•", "å…‰æ˜åŒº"];

            navTree.innerHTML = '';

            // åŠ è½½ä¿å­˜çš„ä¾§è¾¹æ çŠ¶æ€
            const savedState = loadSidebarState();

            regionOrder.forEach(region => {
                const subRegions = db[region] || {};
                if (Object.keys(subRegions).length === 0 && !subRegions._PRICE_MAP) return;

                const l1 = createNode(region, 'level-1 has-arrow', navTree);
                const l1Container = createContainer(navTree);
                l1.onclick = () => toggleNode(l1, l1Container);

                // æ¢å¤å±•å¼€çŠ¶æ€
                if (savedState[region]) {
                    l1.classList.add('open');
                    l1Container.classList.add('show');
                }

                if (subRegions._PRICE_MAP) {
                    const priceNode = createNode('ã€ğŸ’° ä»·æ ¼åŒºé—´ã€‘', 'level-2 summary-entry', l1Container);
                    priceNode.onclick = function () {
                        document.querySelectorAll('.summary-entry, .level-2').forEach(el => el.classList.remove('active'));
                        this.classList.add('active');
                        loadContent(region, 'ä»·æ ¼åŒºé—´', 'ä»·æ ¼åœ°å›¾', 'ä»·æ ¼æ€»è§ˆ', null);
                        if (window.innerWidth <= 768) toggleMobileMenu();
                    };
                }

                let subKeys = Object.keys(subRegions).filter(key => key !== '_PRICE_MAP');
                if (region === "å—å±±åŒº") {
                    const order = ['å‰æµ·', 'ç²¤æµ·è¡—é“', 'åä¾¨åŸ', 'å—å¤´', 'èµ¤æ¹¾', 'è¥¿ä¸½'];
                    subKeys.sort((a, b) => order.indexOf(a) - order.indexOf(b));
                }

                subKeys.forEach(sub => {
                    const projects = subRegions[sub];
                    if (Object.keys(projects).length === 0) return;

                    const l2 = createNode(sub, 'level-2', l1Container);
                    l2.onclick = () => {
                        document.querySelectorAll('.summary-entry, .level-2').forEach(el => el.classList.remove('active'));
                        l2.classList.add('active');
                        showProjectCards(region, sub, projects);
                        if (window.innerWidth <= 768) toggleMobileMenu();
                    };
                });
            });
        }

        initMenu();
        loadCartFromStorage(); // åŠ è½½è´­ç‰©è½¦æ•°æ®
        showiOSGuide();
        loadSharedProjects(); // åŠ è½½åˆ†äº«é“¾æ¥
    </script>
</body>

</html>